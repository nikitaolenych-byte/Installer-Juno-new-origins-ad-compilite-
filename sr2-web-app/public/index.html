<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>SR2 Craft Generator</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 960px; margin: 24px auto; padding: 0 16px; color: #222; }
    label { display:block; margin-top:12px; }
    textarea { width:100%; height:120px }
    .row { display:flex; gap:12px; }
    .controls { display:flex; gap:8px; align-items:center; }
    .btn { padding:8px 12px; border-radius:6px; border:1px solid #ccc; background:#f6f6f6; cursor:pointer; }
    .btn.primary { background:#007bff; color:#fff; border-color:#007bff; }
    .btn.ghost { background:transparent; }
    .btn[disabled] { opacity:0.6; cursor:not-allowed; }
    #status { margin-top:12px; }
    #previewModal textarea { height: 48vh; }
    .spinner { display:inline-block; width:18px; height:18px; border:3px solid rgba(0,0,0,0.12); border-top-color:#007bff; border-radius:50%; animation:spin 1s linear infinite; vertical-align:middle; margin-left:8px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .note { font-size:0.9em; color:#666; }
    /* fullscreen chat */
    .chat-fullscreen { position:fixed !important; left:0 !important; top:0 !important; right:0 !important; bottom:0 !important; width:100% !important; height:100% !important; z-index:2000 !important; border-radius:0 !important; }
    .chat-fullscreen #chatArea { height: calc(100% - 120px) !important; }

  </style>
</head>
<body>
  <div style="display:flex; gap:18px; align-items:flex-start;">
    <div style="flex:1; min-width:280px">
      <h1 style="margin:0 0 8px 0">SR2 Craft Generator — demo</h1>
      <p class="note">Напиши ім'я крафта і опис, або завантаж повний .craft як шаблон.</p>

      <label>Craft name
        <input id="craftName" type="text" value="MyCraft" />
      </label>

      <label>Description (optional)
        <textarea id="description">High-speed craft</textarea>
      </label>

      <div class="row">
        <label>Upload .craft template
          <input id="craftFile" type="file" accept=".craft" />
        </label>
        <button id="uploadBtn" class="btn">Upload Template</button>
      </div>

        <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
        <button id="generateBtn" class="btn primary">Generate & Download .craft</button>
        <button id="aiGenerateBtn" class="btn">AI Generate</button>
        <button id="aiPreviewBtn" class="btn">Preview AI</button>
        <select id="uploadedTemplates"><option value="">— uploaded templates —</option></select>
      </div>
      <div style="margin-top:8px; display:flex; gap:8px; align-items:center;">
        <div style="display:flex; gap:8px;">
          <button id="presetQuick" class="btn">Quick</button>
          <button id="presetDetailed" class="btn">Detailed</button>
          <button id="presetTest" class="btn">With Tests</button>
        </div>
        <div class="note">If download doesn't start on mobile, use Preview AI and choose <strong>Download</strong> from the preview modal (works better on mobile). If that still doesn't start, the preview modal can open the XML in a new tab where you can long-press (mobile) or right-click → Save as (desktop).</div>
      </div>
    </div>

    <!-- Chat column -->
    <div style="width:420px; max-width:44%;">
      <div id="chatPanel" style="border:1px solid #e6e6e6; border-radius:8px; overflow:hidden; display:flex; flex-direction:column; height:560px;">
        <div style="background:#0b5cff; color:#fff; padding:12px; display:flex; align-items:center; gap:12px; justify-content:space-between;">
          <div style="display:flex; gap:12px; align-items:center;">
            <div style="width:36px; height:36px; background:#083ea3; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:700;">CG</div>
            <div>
              <div style="font-weight:700">CraftGen Chat</div>
              <div style="font-size:0.85em; opacity:0.9">AI assistant for SimpleRockets 2</div>
            </div>
          </div>
          <div style="display:flex; gap:8px; align-items:center;">
            <label class="note" style="color:#fff; margin:0;">Model: <input id="modelInput" value="gpt-4o-mini" style="width:140px; padding:4px; border-radius:4px; border:0;" /></label>
            <label style="color:#fff; font-size:0.85em"><input type="checkbox" id="autoSpeak" /> Auto Speak</label>
            <button id="fullscreenBtn" class="btn ghost" style="color:#fff; border-color:rgba(255,255,255,0.18);">Fullscreen</button>
          </div>
        </div>
        <div id="chatArea" style="flex:1; padding:12px; overflow:auto; background:#fafafa;"></div>
        <div style="padding:10px; border-top:1px solid #eee; display:flex; gap:8px; align-items:center;">
          <select id="chatAction" style="padding:8px;">
            <option value="preview">Preview (recommended)</option>
            <option value="generate">Generate & Download</option>
          </select>
          <input id="chatInput" placeholder="Опишіть, який крафт ви хочете (наприклад: 'швидка ракета з великою ємністю палива')" style="flex:1; padding:8px; border-radius:6px; border:1px solid #ddd;" />
          <button id="chatSend" class="btn primary">Send</button>
        </div>
      </div>
      <div class="note" style="margin-top:8px">Натисніть <strong>Send</strong>, щоб отримати відповідь від AI. Можна використовувати Preview щоб переглядати XML перед скачуванням.</div>
    </div>
  </div>

  <div id="status" style="margin-top:18px;color:#444"></div>

  <!-- Preview modal -->
  <div id="previewModal" style="display:none; position:fixed; left:0; top:0; right:0; bottom:0; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:1000;">
    <div style="background:#fff; max-width:900px; width:95%; padding:16px; border-radius:8px; max-height:80vh; overflow:auto;">
      <h3>AI Preview</h3>
      <div id="previewInfo" style="color:#900; margin-bottom:8px;"></div>
      <textarea id="previewXml" style="width:100%; height:360px; font-family: monospace;"></textarea>
      <div style="margin-top:8px; display:flex; gap:8px; justify-content:flex-end; align-items:center;">
        <button id="previewRunTestsBtn" class="btn">Run Tests</button>
        <button id="previewDownloadBtn" class="btn">Download</button>
        <button id="previewApplyBtn" class="btn primary">Accept & Download</button>
        <button id="previewCloseBtn" class="btn ghost">Close</button>
      </div>
      <div id="previewTestResults" style="margin-top:8px; font-size:0.9em; color:#333"></div>
    </div>
  </div>

  <!-- Logs / Chat panel -->
  <div id="bottomPanel" style="position:fixed; right:24px; left:24px; bottom:24px; max-height:40vh; background:#fff; border:1px solid #e6e6e6; border-radius:8px; overflow:hidden; box-shadow:0 8px 30px rgba(0,0,0,0.08);">
    <div style="display:flex; align-items:center; justify-content:space-between; padding:8px 12px; border-bottom:1px solid #eee; background:#fafafa;">
      <div style="font-weight:600">Activity</div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button id="toggleHistoryBtn" class="btn">History</button>
        <button id="toggleLogsBtn" class="btn">Server Logs</button>
        <button id="closePanelBtn" class="btn ghost">Close</button>
      </div>
    </div>
    <div id="historyArea" style="padding:12px; overflow:auto; height: calc(40vh - 50px); background:#fff;"></div>
    <div id="logsArea" style="display:none; padding:12px; overflow:auto; height: calc(40vh - 50px); background:#111; color:#0f0; font-family:monospace; font-size:12px;"></div>
  </div>

  <script src="main.js"></script>
</body>
</html>
